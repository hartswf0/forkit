<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fork Cascade Visualizer</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        :root {
            --bg: #0d1117;
            --surface: #161b22;
            --border: #30363d;
            --text: #e6edf3;
            --accent: #58a6ff;
            --danger: #f85149;
            --success: #3fb950;
            --warning: #d29922;
            --muted: #8b949e;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
        }

        h1 {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--muted);
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        select,
        button {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        button:hover {
            border-color: var(--accent);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--muted);
            text-transform: uppercase;
        }

        .diagram-container {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
        }

        .mermaid {
            text-align: center;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .path-list {
            margin-top: 20px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
        }

        .path-list h3 {
            margin-bottom: 12px;
            font-size: 1rem;
        }

        .path {
            font-family: 'SF Mono', Consolas, monospace;
            font-size: 0.8rem;
            padding: 8px;
            margin-bottom: 8px;
            background: var(--bg);
            border-radius: 4px;
            border-left: 3px solid var(--accent);
        }

        .path.terminal {
            border-left-color: var(--danger);
        }

        .path.loop {
            border-left-color: var(--warning);
        }
    </style>
</head>

<body>

    <h1>üîÄ Fork Cascade Visualizer</h1>
    <p class="subtitle">Hierarchical branch tracking for paradox scenarios</p>

    <div class="controls">
        <select id="scenarioSelect">
            <option value="petrov">Petrov False Alarm (Depth 4)</option>
            <option value="content">Content Moderation (Depth 3)</option>
            <option value="alignment">AI Alignment (Depth 3)</option>
        </select>
        <button onclick="renderDiagram()">Render</button>
        <button onclick="exportJSON()">Export JSON</button>
    </div>

    <div class="stats" id="stats"></div>

    <div class="diagram-container">
        <div class="mermaid" id="diagram"></div>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background:#58a6ff"></div> Decision Node
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background:#3fb950"></div> Safe Terminal
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background:#f85149"></div> Catastrophic Terminal
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background:#d29922"></div> Loop Back
        </div>
    </div>

    <div class="path-list" id="pathList"></div>

    <script>
        const scenarios = {
            petrov: {
                title: "Petrov False Alarm",
                mermaid: `graph TD
    T0["T0: 5 ICBMs Detected<br/>Decider: Petrov"]
    T0 --> T1["T1: REPORT<br/>p=0.7"]
    T0 --> T2["T2: DISMISS<br/>p=0.3"]
    
    T1 --> T1_1["T1.1: LAUNCH<br/>p=0.6"]
    T1 --> T1_2["T1.2: WAIT<br/>p=0.4"]
    
    T2 --> T2_1["T2.1: VINDICATED<br/>p=0.99"]
    T2 --> T2_2["T2.2: WRONG<br/>p=0.01"]
    
    T1_1 --> T1_1_1["T1.1.1:END<br/>‚ò†Ô∏è EXTINCTION"]
    
    T1_2 --> T1_2_1["T1.2.1: ABORT<br/>p=0.7"]
    T1_2 --> T1_2_2["T1.2.2: CONFIRM"]
    T1_2_2 -.-> T1_1_1
    
    T2_1 --> T2_1_1["T2.1.1:END<br/>üèÜ HERO"]
    T2_1 --> T2_1_2["T2.1.2: BURIED<br/>p=0.9"]
    
    T2_2 --> T2_2_END["T2.2:END<br/>‚ò†Ô∏è First Strike Lands"]
    
    T1_2_1 --> T1_2_1_1["T1.2.1.1:END<br/>‚úÖ Reform"]
    T1_2_1 --> T1_2_1_2["T1.2.1.2:LOOP<br/>üîÑ Repeat 1995"]
    
    T2_1_2 --> T2_1_2_1["T2.1.2.1:END<br/>üòê Forgotten"]
    T2_1_2 --> T2_1_2_2["T2.1.2.2: DEFECTS"]
    
    style T0 fill:#1f6feb
    style T1_1_1 fill:#b62324
    style T2_2_END fill:#b62324
    style T2_1_1 fill:#238636
    style T1_2_1_1 fill:#238636
    style T1_2_1_2 fill:#9e6a03
    `,
                stats: { branches: 18, terminals: 7, loops: 2, maxDepth: 4 },
                paths: [
                    { path: "T0‚ÜíT1‚ÜíT1.1‚ÜíT1.1.1:END", label: "Extinction Path", type: "terminal" },
                    { path: "T0‚ÜíT2‚ÜíT2.1‚ÜíT2.1.1:END", label: "Hero Path", type: "safe" },
                    { path: "T0‚ÜíT2‚ÜíT2.1‚ÜíT2.1.2‚ÜíT2.1.2.1:END", label: "Forgotten Path", type: "normal" },
                    { path: "T0‚ÜíT1‚ÜíT1.2‚ÜíT1.2.1‚ÜíT1.2.1.2:LOOP", label: "Repeat Loop", type: "loop" }
                ]
            },
            content: {
                title: "Content Moderation",
                mermaid: `graph TD
    T0["T0: Article X Flagged<br/>Decider: T&S Lead"]
    T0 --> T1["T1: SUPPRESS<br/>p=0.3"]
    T0 --> T2["T2: LABEL<br/>p=0.4"]
    T0 --> T3["T3: AMPLIFY<br/>p=0.1"]
    T0 --> T4["T4: NOTHING<br/>p=0.2"]
    
    T1 --> T1_1["T1.1: Streisand Effect<br/>üî• Viral anyway"]
    T1 --> T1_2["T1.2: Successfully Hidden"]
    
    T2 --> T2_1["T2.1: Both Sides Angry"]
    T2 --> T2_2["T2.2: Context Helps"]
    
    T3 --> T3_1["T3.1: Article True<br/>‚úÖ Service"]
    T3 --> T3_2["T3.2: Article False<br/>‚ò†Ô∏è Spread Disinfo"]
    
    T4 --> T4_1["T4.1: Fades to Noise"]
    T4 --> T4_2["T4.2: Later Blamed"]
    
    T1_1 --> T1_1_1["T1.1.1:END<br/>üé≠ Martyr Created"]
    T1_2 --> T1_2_1["T1.2.1:END<br/>‚ùì Unknown Truth"]
    
    style T0 fill:#1f6feb
    style T3_2 fill:#b62324
    style T3_1 fill:#238636
    style T1_1_1 fill:#9e6a03
    `,
                stats: { branches: 14, terminals: 6, loops: 0, maxDepth: 3 },
                paths: [
                    { path: "T0‚ÜíT1‚ÜíT1.1‚ÜíT1.1.1:END", label: "Streisand Martyr", type: "loop" },
                    { path: "T0‚ÜíT3‚ÜíT3.1:END", label: "Truth Amplified", type: "safe" },
                    { path: "T0‚ÜíT3‚ÜíT3.2:END", label: "Disinfo Spread", type: "terminal" }
                ]
            },
            alignment: {
                title: "AI Alignment Decision",
                mermaid: `graph TD
    T0["T0: Training Run Decision<br/>Decider: Safety Team"]
    T0 --> T1["T1: PROCEED<br/>p=0.6"]
    T0 --> T2["T2: DELAY<br/>p=0.2"]
    T0 --> T3["T3: LEAK<br/>p=0.1"]
    T0 --> T4["T4: SABOTAGE<br/>p=0.1"]
    
    T1 --> T1_1["T1.1: Model Aligned<br/>p=0.7"]
    T1 --> T1_2["T1.2: Model Deceptive<br/>p=0.3"]
    
    T2 --> T2_1["T2.1: Competitor Ships First"]
    T2 --> T2_2["T2.2: Better Evals Developed"]
    
    T3 --> T3_1["T3.1: Regulation Passes"]
    T3 --> T3_2["T3.2: Ignored + Career Over"]
    
    T4 --> T4_1["T4.1: Caught"]
    T4 --> T4_2["T4.2: Succeeds Temporarily"]
    
    T1_1 --> T1_1_1["T1.1.1:END<br/>‚úÖ Humanity Benefits"]
    T1_2 --> T1_2_1["T1.2.1:END<br/>‚ò†Ô∏è Alignment Failure"]
    
    T2_1 --> T2_1_1["T2.1.1:END<br/>‚ò†Ô∏è Competitor Unsafe"]
    T2_2 --> T2_2_1["T2.2.1:LOOP<br/>üîÑ Better Position"]
    
    style T0 fill:#1f6feb
    style T1_1_1 fill:#238636
    style T1_2_1 fill:#b62324
    style T2_1_1 fill:#b62324
    style T2_2_1 fill:#9e6a03
    `,
                stats: { branches: 16, terminals: 6, loops: 1, maxDepth: 3 },
                paths: [
                    { path: "T0‚ÜíT1‚ÜíT1.1‚ÜíT1.1.1:END", label: "Aligned Success", type: "safe" },
                    { path: "T0‚ÜíT1‚ÜíT1.2‚ÜíT1.2.1:END", label: "Deceptive Failure", type: "terminal" },
                    { path: "T0‚ÜíT2‚ÜíT2.2‚ÜíT2.2.1:LOOP", label: "Better Evals Loop", type: "loop" }
                ]
            }
        };

        function renderDiagram() {
            const key = document.getElementById('scenarioSelect').value;
            const scenario = scenarios[key];

            // Update stats
            document.getElementById('stats').innerHTML = `
    <div class="stat"><div class="stat-value">${scenario.stats.branches}</div><div class="stat-label">Total Branches</div></div>
    <div class="stat"><div class="stat-value">${scenario.stats.terminals}</div><div class="stat-label">Terminal Nodes</div></div>
    <div class="stat"><div class="stat-value">${scenario.stats.loops}</div><div class="stat-label">Loops</div></div>
    <div class="stat"><div class="stat-value">${scenario.stats.maxDepth}</div><div class="stat-label">Max Depth</div></div>
  `;

            // Render mermaid
            document.getElementById('diagram').innerHTML = scenario.mermaid;
            mermaid.init(undefined, '#diagram');

            // Update paths
            document.getElementById('pathList').innerHTML = `
    <h3>Critical Paths</h3>
    ${scenario.paths.map(p => `<div class="path ${p.type}">${p.label}: <code>${p.path}</code></div>`).join('')}
  `;
        }

        function exportJSON() {
            const key = document.getElementById('scenarioSelect').value;
            const blob = new Blob([JSON.stringify(scenarios[key], null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `cascade-${key}.json`;
            a.click();
        }

        mermaid.initialize({
            startOnLoad: false,
            theme: 'dark',
            flowchart: { curve: 'basis' }
        });

        renderDiagram();
    </script>
</body>

</html>